<!DOCTYPE html><html><head><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism.css" as="style"/><link rel="preload" href="https://unpkg.com/prismjs@0.0.1/themes/prism-tomorrow.css" as="style"/><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta name="theme-color" content="#90cdf4"/><meta name="apple-mobile-web-app-status-bar" content="#90cdf4"/><link rel="icon" href="/favicon.ico"/><link rel="manifest" href="/manifest.json"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="preconnect" href="https://fonts.gstatic.com"/><link href="https://fonts.googleapis.com/css2?family=Lora&amp;family=Roboto:wght@400;500&amp;display=swap" rel="stylesheet"/><title>179 Tangrams</title><link href="https://unpkg.com/prismjs@0.0.1/themes/prism.css" rel="stylesheet"/><meta name="next-head-count" content="13"/><link rel="preload" href="/_next/static/css/fe79b6602d42739970b1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fe79b6602d42739970b1.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-61129d213dfda76573c6.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" as="script"/><link rel="preload" href="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.096d8e50c76d292127d5.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-45fefa48abe535254545.js" as="script"/><link rel="preload" href="/_next/static/chunks/31be47c519c864dead363477679f4a7420a51993.fc03b16d3e52c095d9fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/projects/%5Bid%5D-e67dad879942af187726.js" as="script"/></head><body><div id="__next"><nav class="nav"><div><a href="/"><div id="home-link">howard hwang</div></a><div><a href="/about">about</a></div></div></nav><div id="main"><div class="center-card"><div style="text-align:center">
  <h1>179 Tangrams</h1>
  <div>
    <a href="https://twpride.github.io/tangram/">
    Live Site
    </a>
  </div>
  <video controls muted autoplay loop height="480" src="https://howardhwang.s3-us-west-1.amazonaws.com/gamefull.mp4"></video>
</div>
<p>Tangrams is a browser implementation of the classic Chinese puzzle using plain JavaScript(no packages) and the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API">Canvas API</a>. The puzzle consists of seven polygons tiles, which are put together to form shapes. The objective is to replicate a given pattern using all seven tiles without overlap.</p>
<h1>Challenges</h1>
<h2>Puzzle solve state detection</h2>
<h3>Motivation: timed gameplay</h3>
<p>A dimension that is unique to this implementation of Tangram is that the player is scored by how quickly he/she can solve a puzzle. A timer automatically starts when the player enters a level and is only stopped whenever the user exits (by hitting pause, or switching tabs) or when the puzzle is solved. This added timing component means that the program would need a quick and cheap way to constantly check whether the puzzle had been solved.</p>
<h3>Solution: counting pixels on a secondary &#x3C;canvas></h3>
<p>For the aforementioned task, a raster based overlap detection algorithm was developed. The approach involves painting the silhouette and tiles onto a secondary canvas, making sure the two entities are centered with respect to one another, and then counting the non-overlapping pixels on the silhoutte.</p>
<p>The screenshot below shows live gameplay with the secondary canvas overlayed on top. As the tiles on the main canvas moves, the secondary canvas is also updated. The green counter is a live reading of sum of total number of non-overlapping silhouette pixels. Notice that when the when the probem solved, the green coutner drops to below 6000, which is the solve threshold, and the timer stops.</p>
<div style="display: flex; justify-content: center; align-item: center">
 <img width="360" height="auto" src="https://raw.githubusercontent.com/twpride/tangram/master/demo/sil_opt.gif"></img>
</div>
<h3>Algorithm details</h3>
<p>We start out painting the silhouette then the tangram tiles on a secondary canvas that is off-screen. By ensuring that the geometric centers of the silhouette and the tangram tiles align, it follows that there is maximum overlap between the tangram tiles and the silhouette when the puzzle is solved. Conversely, this means that the non-overlapping areas of the silhouette is at a minimum.</p>
<p>To detect this solved state, we set both the background and the tile to black (rgb(0,0,0)) while the silhouette set to any non-black color which in our case was cyan, most importantly with a red color value of 1, rgb(1,255,255). Since the tangrams shapes are painted after the silhouette, any overlapping areas will be set to black, whereas the non-overlapping areas of the silhouette remain cyan.</p>
<p>After every tile move, the program sums the red pixel values of all the pixels on the secondary canvas (using <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/getImageData">CanvasRenderingContext2D.getImageData()</a>). Since we had set the silhouette to have a red color value of 1, the sum is also the number of pixels of silhouette that is non-overlapping. If the non-overlap pixel count is below a certain threshold (empirically determined), we can conclude that the player has solved the puzzle.</p>
<h2>A custom carousel element</h2>
<div style="display: flex; justify-content: center; align-item: center">
  <img width="360" height="auto" src="https://raw.githubusercontent.com/twpride/tangram/master/demo/slider_opt.gif"></img>
</div>
<h3>Hover preview</h3>
<p>As the use hover the mouse over each problem icon in the carousel, the game canvas updates with a preview of the problem and the current state of the tiles in that level. The silhouette for unsolved problems are blurred in the preview to prevent the player from getting a head start before starting the timer.</p>
<h3>Page snap easing animation</h3>
<p>To allow for smooth transition between pages, the carousel utilizes a <a href="https://github.com/gre/bezier-easing">Bezier easing function</a> to generate the snapping animation to the nearest page.</p>
<h3>Integrated heatmap</h3>
<p>The carousel also functions as a heat map that tracks the player's progress. The heat maps colors each level icon depending on elapsed time and the puzzle solve state. The heatmap is generated by formatting an <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/color_value#hsl_colors">HSL</a> color string with the which becomes an attributes of a SVG <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Element/rect">&#x3C;rect></a> element.</p>
<p>The heat map adds a badge-like reward mechanism to the gameplay experience. The user may be motivated to fill up the entire carousel with green boxes :)</p>
<h2>Collision detection</h2>
<div style="display: flex; justify-content: center; align-item: center">
  <img width="360" height="auto" src="https://raw.githubusercontent.com/twpride/tangram/master/demo/collision_opt.gif"></img>
</div>
<p>Adding realism to the game play, the program checks for collision between the puzzle tiles. After each tile move, if there is a collision, the penetration amount between the penetrating vertex and the penetrated edge is calculated.</p>
<p>Before we can calculate the penetration amount, we first need to find all the vertices that have penetrated another polygon by iterating through each vertex polygon combination possible (with some pruning) running the following function.</p>
<p>Note: All points and vectors in the format of a length 2 array [x-component,y-compoent],</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">toVec</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span>b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">cross</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> w</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> w<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> w<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">insidePoly</span><span class="token punctuation">(</span><span class="token parameter">vertices<span class="token punctuation">,</span> p</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// checks if point p in located inside polygon with def by the vertices argment</span>
  <span class="token comment">// important!! this assumes vertices are arranged in counter clockwise order</span>
  <span class="token keyword">let</span> left <span class="token operator">=</span> vertices<span class="token punctuation">[</span>vertices<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> vertices<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> center <span class="token operator">=</span> vertices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span><span class="token function">cross</span><span class="token punctuation">(</span><span class="token function">toVec</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> left<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">toVec</span><span class="token punctuation">(</span>center<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    left <span class="token operator">=</span> center<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div>
<p>After we identify the penetrating vertice / penetrated polygon pair, we check the penetrating vertex's latest path segment (defined by its last two recorded positions) for intersection with each edge of the penetrated polygon. Knowing the penetrating vertex and penetrated edge, we calculate the the perpendicular component between them. This perpendicular vector is exactly how much the vertex has penetrated the polygon. The code snippet for this procedure is pasted below. Note that <code>calcPenetration()</code> calls <code>findIntersection()</code></p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">findIntersection</span><span class="token punctuation">(</span><span class="token parameter">p<span class="token punctuation">,</span> r<span class="token punctuation">,</span> q<span class="token punctuation">,</span> s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/*</span>
<span class="token comment">    Based on: https://stackoverflow.com/questions/563198/</span>
<span class="token comment"></span>
<span class="token comment">    q+s  p+r</span>
<span class="token comment">      \/__________ q+u*s</span>
<span class="token comment">      /\  </span>
<span class="token comment">     /  \</span>
<span class="token comment">    p    q</span>
<span class="token comment">    </span>
<span class="token comment">    u = (q − p) × r / (r × s)</span>
<span class="token comment">    when r × s = 0, the lines are either colinear or parallel</span>
<span class="token comment"></span>
<span class="token comment">    function returns u</span>
<span class="token comment">    for intersection to exist, 0&#x3C;u&#x3C;1</span>
<span class="token comment">  */</span>
  <span class="token keyword">const</span> q_minus_p <span class="token operator">=</span> <span class="token function">toVec</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> r_cross_s <span class="token operator">=</span> <span class="token function">cross</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>r_cross_s <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token function">cross</span><span class="token punctuation">(</span>q_minus_p<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">/</span> r_cross_s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword module">export</span> <span class="token keyword">const</span> <span class="token function-variable function">dot</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span> w</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> w<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> w<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword module">export</span> <span class="token keyword">function</span> <span class="token function">calcPenetration</span><span class="token punctuation">(</span><span class="token parameter">sVertices<span class="token punctuation">,</span> p<span class="token punctuation">,</span> lastMouseMove</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">/*</span>
<span class="token comment">    determine if last mouse move caused a state change for point p</span>
<span class="token comment">    from no penetration to penetration into shape s (represented by sVertices)</span>
<span class="token comment"></span>
<span class="token comment">    if such state change occured, return the penetration vector</span>
<span class="token comment">    if not, this return null</span>
<span class="token comment">  */</span>
  <span class="token keyword">let</span> prev <span class="token operator">=</span> sVertices<span class="token punctuation">[</span>sVertices<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// scale last mouse move vector by 20%, empirically this has been found to help </span>
  <span class="token comment">// with interseciton detection sensitivity</span>
  lastMouseMove <span class="token operator">=</span> lastMouseMove<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">ele</span> <span class="token arrow operator">=></span> ele <span class="token operator">*</span> <span class="token number">1.2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// iterate through each polygon edge, return if penetration is encountered</span>
  <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&#x3C;</span> sVertices<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> currVertex <span class="token operator">=</span> sVertices<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> edgeVec <span class="token operator">=</span> <span class="token function">toVec</span><span class="token punctuation">(</span>currVertex<span class="token punctuation">,</span> prev<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// vector respresenting current polygon edge</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">findIntersection</span><span class="token punctuation">(</span>currVertex<span class="token punctuation">,</span> edgeVec<span class="token punctuation">,</span> p<span class="token punctuation">,</span> lastMouseMove<span class="token punctuation">)</span>
    <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>res
      <span class="token operator">&#x26;&#x26;</span> res <span class="token operator">></span> <span class="token number">0</span> <span class="token comment">// res==0, when p started on on the polygon edge</span>
      <span class="token operator">&#x26;&#x26;</span> res <span class="token operator">&#x3C;</span> <span class="token number">1</span> <span class="token comment">// res==1, when p is on polygon edge after mouse move</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// point indeed penetrated the current polygon edge</span>
      <span class="token comment">// calculate and return perpendicular component between p and the polygon edge</span>
      <span class="token keyword">const</span> p_currVertex_vec <span class="token operator">=</span> <span class="token function">toVec</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> currVertex<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>
      <span class="token keyword">const</span> precalc <span class="token operator">=</span> <span class="token function">dot</span><span class="token punctuation">(</span>p_currVertex_vec<span class="token punctuation">,</span> edgeVec<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>edgeVec<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> edgeVec<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">return</span> p_currVertex_vec<span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ele<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> ele <span class="token operator">-</span> precalc <span class="token operator">*</span> edgeVec<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    prev <span class="token operator">=</span> currVertex<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">return</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Knowing this penetration vector, the moving tile is then shifted back by the this exact amount, ensuring that the tiles are just touching, but not intersecting</p>
<h2>Puzzle generation</h2>
<p>Instead of generating the problem manually, examples of Tangram problems found online were leveraged. The 179 puzzles in this game was taken from a <a href="https://web.archive.org/web/20200203050759/https://www.cs.brandeis.edu/~storer/JimPuzzles/ZPAGES/zzzRichter08-AnchorPuzzle.html">puzzle booklet</a> first published in 1890 by the Richter Company of Germany in 1890. The problems were extracted from scanned images of the puzzle booklet with a <a href="https://github.com/twpride/tangram/blob/master/scratch/process179.py">python script</a> using OpenCv's <code>findContours()</code>.</p>
<h1>Features to add</h1>
<ul>
<li>User generated levels</li>
<li>Public high score leader board</li>
</ul>
</div></div><div id="footer"><div><div id="email" class="tooltip"><span class="tooltiptext">email copied to clipboard</span><span class="tooltiptext">copy email to clipboard</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24px" height="24px"><path d="M0 0h24v24H0z" fill="none"></path><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"></path></svg></div><a href="https://github.com/twpride/tangram"><svg id="github" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M 12.039683,-1.9101289e-4 C 5.3777255,-1.9101289e-4 0,5.3774113 0,12.039218 c 0,5.297339 3.451376,9.792052 8.267249,11.397306 0.642117,0.08027 0.802646,-0.240787 0.802646,-0.561839 v -2.08683 C 5.698783,21.510219 4.9764025,19.1826 4.9764025,19.1826 4.4145508,17.818134 3.6119047,17.41682 3.6119047,17.41682 c -1.1237034,-0.722365 0.080268,-0.722365 0.080268,-0.722365 1.2039691,0.08027 1.8460852,1.203942 1.8460852,1.203942 C 6.581697,19.74444 8.347518,19.1826 9.069898,18.86155 9.150168,18.058922 9.471221,17.577345 9.872544,17.256295 7.2238131,16.935244 4.4145544,15.891828 4.4145544,11.316853 c 0,-1.284203 0.4815874,-2.4078819 1.2039678,-3.2105099 C 5.4579935,7.7852929 5.0566705,6.581352 5.6987902,4.8958348 c 0,0 1.0434391,-0.3210508 3.2908468,1.2039409 0.963175,-0.2407882 2.006614,-0.4013137 3.050053,-0.4013137 1.04344,0 2.086879,0.1605255 3.050053,0.4013137 2.327673,-1.5249917 3.290848,-1.2039409 3.290848,-1.2039409 0.642116,1.6855172 0.240793,2.8894581 0.08027,3.2105083 0.802645,0.802628 1.203968,1.9263069 1.203968,3.2105099 0,4.655239 -2.809259,5.618391 -5.45799,5.939442 0.401323,0.401313 0.802646,1.123678 0.802646,2.247357 v 3.29077 c 0,0.321051 0.240793,0.722365 0.802646,0.56184 4.815872,-1.605255 8.186984,-6.099967 8.186984,-11.397307 C 24.079385,5.3774113 18.701654,-1.9101289e-4 12.039696,-1.9101289e-4 Z"></path></svg></a><a href="https://www.linkedin.com/in/howard-hwang-b3000335"><svg id="linkedin" xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24"><path d="M 20.449136,20.449793 H 16.893088 V 14.88096 c 0,-1.32794 -0.02371,-3.037409 -1.849517,-3.037409 -1.852109,0 -2.135482,1.446844 -2.135482,2.940731 v 5.665141 H 9.35204 V 8.9976456 h 3.413807 v 1.5650064 h 0.04778 c 0.696095,-1.1901624 1.990397,-1.9010004 3.368247,-1.8498564 3.604203,0 4.26874,2.3706614 4.26874,5.4547444 z M 5.3396305,7.4322684 C 3.5010137,7.4325984 2.5801652,5.2099932 3.8798725,3.9098412 5.1795802,2.6096868 7.40255,3.5297232 7.40288,5.3683104 7.4030845,6.5079984 6.4793362,7.4320632 5.3396305,7.4322684 M 7.1176553,20.449793 H 3.5579016 V 8.9976456 H 7.1176553 Z M 22.221976,0.0028368 H 1.7709868 C 0.8044308,-0.0080724 0.0117962,0.7661496 0,1.7326788 V 22.268164 c 0.011388,0.966996 0.803963,1.741982 1.7709868,1.731695 H 22.221976 C 23.190912,24.012003 23.986586,23.237069 24,22.268164 V 1.7311968 C 23.986188,0.7627584 23.190444,-0.011418 22.221976,0.0013548"></path></svg></a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"tangram","contentHtml":"\u003cdiv style=\"text-align:center\"\u003e\n  \u003ch1\u003e179 Tangrams\u003c/h1\u003e\n  \u003cdiv\u003e\n    \u003ca href=\"https://twpride.github.io/tangram/\"\u003e\n    Live Site\n    \u003c/a\u003e\n  \u003c/div\u003e\n  \u003cvideo controls muted autoplay loop height=\"480\" src=\"https://howardhwang.s3-us-west-1.amazonaws.com/gamefull.mp4\"\u003e\u003c/video\u003e\n\u003c/div\u003e\n\u003cp\u003eTangrams is a browser implementation of the classic Chinese puzzle using plain JavaScript(no packages) and the \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API\"\u003eCanvas API\u003c/a\u003e. The puzzle consists of seven polygons tiles, which are put together to form shapes. The objective is to replicate a given pattern using all seven tiles without overlap.\u003c/p\u003e\n\u003ch1\u003eChallenges\u003c/h1\u003e\n\u003ch2\u003ePuzzle solve state detection\u003c/h2\u003e\n\u003ch3\u003eMotivation: timed gameplay\u003c/h3\u003e\n\u003cp\u003eA dimension that is unique to this implementation of Tangram is that the player is scored by how quickly he/she can solve a puzzle. A timer automatically starts when the player enters a level and is only stopped whenever the user exits (by hitting pause, or switching tabs) or when the puzzle is solved. This added timing component means that the program would need a quick and cheap way to constantly check whether the puzzle had been solved.\u003c/p\u003e\n\u003ch3\u003eSolution: counting pixels on a secondary \u0026#x3C;canvas\u003e\u003c/h3\u003e\n\u003cp\u003eFor the aforementioned task, a raster based overlap detection algorithm was developed. The approach involves painting the silhouette and tiles onto a secondary canvas, making sure the two entities are centered with respect to one another, and then counting the non-overlapping pixels on the silhoutte.\u003c/p\u003e\n\u003cp\u003eThe screenshot below shows live gameplay with the secondary canvas overlayed on top. As the tiles on the main canvas moves, the secondary canvas is also updated. The green counter is a live reading of sum of total number of non-overlapping silhouette pixels. Notice that when the when the probem solved, the green coutner drops to below 6000, which is the solve threshold, and the timer stops.\u003c/p\u003e\n\u003cdiv style=\"display: flex; justify-content: center; align-item: center\"\u003e\n \u003cimg width=\"360\" height=\"auto\" src=\"https://raw.githubusercontent.com/twpride/tangram/master/demo/sil_opt.gif\"\u003e\u003c/img\u003e\n\u003c/div\u003e\n\u003ch3\u003eAlgorithm details\u003c/h3\u003e\n\u003cp\u003eWe start out painting the silhouette then the tangram tiles on a secondary canvas that is off-screen. By ensuring that the geometric centers of the silhouette and the tangram tiles align, it follows that there is maximum overlap between the tangram tiles and the silhouette when the puzzle is solved. Conversely, this means that the non-overlapping areas of the silhouette is at a minimum.\u003c/p\u003e\n\u003cp\u003eTo detect this solved state, we set both the background and the tile to black (rgb(0,0,0)) while the silhouette set to any non-black color which in our case was cyan, most importantly with a red color value of 1, rgb(1,255,255). Since the tangrams shapes are painted after the silhouette, any overlapping areas will be set to black, whereas the non-overlapping areas of the silhouette remain cyan.\u003c/p\u003e\n\u003cp\u003eAfter every tile move, the program sums the red pixel values of all the pixels on the secondary canvas (using \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/getImageData\"\u003eCanvasRenderingContext2D.getImageData()\u003c/a\u003e). Since we had set the silhouette to have a red color value of 1, the sum is also the number of pixels of silhouette that is non-overlapping. If the non-overlap pixel count is below a certain threshold (empirically determined), we can conclude that the player has solved the puzzle.\u003c/p\u003e\n\u003ch2\u003eA custom carousel element\u003c/h2\u003e\n\u003cdiv style=\"display: flex; justify-content: center; align-item: center\"\u003e\n  \u003cimg width=\"360\" height=\"auto\" src=\"https://raw.githubusercontent.com/twpride/tangram/master/demo/slider_opt.gif\"\u003e\u003c/img\u003e\n\u003c/div\u003e\n\u003ch3\u003eHover preview\u003c/h3\u003e\n\u003cp\u003eAs the use hover the mouse over each problem icon in the carousel, the game canvas updates with a preview of the problem and the current state of the tiles in that level. The silhouette for unsolved problems are blurred in the preview to prevent the player from getting a head start before starting the timer.\u003c/p\u003e\n\u003ch3\u003ePage snap easing animation\u003c/h3\u003e\n\u003cp\u003eTo allow for smooth transition between pages, the carousel utilizes a \u003ca href=\"https://github.com/gre/bezier-easing\"\u003eBezier easing function\u003c/a\u003e to generate the snapping animation to the nearest page.\u003c/p\u003e\n\u003ch3\u003eIntegrated heatmap\u003c/h3\u003e\n\u003cp\u003eThe carousel also functions as a heat map that tracks the player's progress. The heat maps colors each level icon depending on elapsed time and the puzzle solve state. The heatmap is generated by formatting an \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/color_value#hsl_colors\"\u003eHSL\u003c/a\u003e color string with the which becomes an attributes of a SVG \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/SVG/Element/rect\"\u003e\u0026#x3C;rect\u003e\u003c/a\u003e element.\u003c/p\u003e\n\u003cp\u003eThe heat map adds a badge-like reward mechanism to the gameplay experience. The user may be motivated to fill up the entire carousel with green boxes :)\u003c/p\u003e\n\u003ch2\u003eCollision detection\u003c/h2\u003e\n\u003cdiv style=\"display: flex; justify-content: center; align-item: center\"\u003e\n  \u003cimg width=\"360\" height=\"auto\" src=\"https://raw.githubusercontent.com/twpride/tangram/master/demo/collision_opt.gif\"\u003e\u003c/img\u003e\n\u003c/div\u003e\n\u003cp\u003eAdding realism to the game play, the program checks for collision between the puzzle tiles. After each tile move, if there is a collision, the penetration amount between the penetrating vertex and the penetrated edge is calculated.\u003c/p\u003e\n\u003cp\u003eBefore we can calculate the penetration amount, we first need to find all the vertices that have penetrated another polygon by iterating through each vertex polygon combination possible (with some pruning) running the following function.\u003c/p\u003e\n\u003cp\u003eNote: All points and vectors in the format of a length 2 array [x-component,y-compoent],\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003etoVec\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ea\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e b\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eb\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e a\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e b\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e a\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003ecross\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ev\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e w\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e w\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e w\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003einsidePoly\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003evertices\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e p\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// checks if point p in located inside polygon with def by the vertices argment\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// important!! this assumes vertices are arranged in counter clockwise order\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e left \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e vertices\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003evertices\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elength\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003efor\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e i \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e vertices\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elength\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e i\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e center \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e vertices\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ei\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003ecross\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token function\"\u003etoVec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e left\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token function\"\u003etoVec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecenter\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e p\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003efalse\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    left \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e center\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token boolean\"\u003etrue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eAfter we identify the penetrating vertice / penetrated polygon pair, we check the penetrating vertex's latest path segment (defined by its last two recorded positions) for intersection with each edge of the penetrated polygon. Knowing the penetrating vertex and penetrated edge, we calculate the the perpendicular component between them. This perpendicular vector is exactly how much the vertex has penetrated the polygon. The code snippet for this procedure is pasted below. Note that \u003ccode\u003ecalcPenetration()\u003c/code\u003e calls \u003ccode\u003efindIntersection()\u003c/code\u003e\u003c/p\u003e\n\u003cdiv class=\"remark-highlight\"\u003e\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003efindIntersection\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e r\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e q\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e s\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e/*\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    Based on: https://stackoverflow.com/questions/563198/\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    q+s  p+r\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e      \\/__________ q+u*s\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e      /\\  \u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e     /  \\\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    p    q\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    \u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    u = (q − p) × r / (r × s)\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    when r × s = 0, the lines are either colinear or parallel\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    function returns u\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    for intersection to exist, 0\u0026#x3C;u\u0026#x3C;1\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e  */\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e q_minus_p \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003etoVec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e q\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e r_cross_s \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003ecross\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003er\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e s\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003er_cross_s \u003cspan class=\"token operator\"\u003e===\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword null nil\"\u003enull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token function\"\u003ecross\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eq_minus_p\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e r\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e r_cross_s\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"token function-variable function\"\u003edot\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003ev\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e w\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e w\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e v\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e w\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token keyword module\"\u003eexport\u003c/span\u003e \u003cspan class=\"token keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"token function\"\u003ecalcPenetration\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003esVertices\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e p\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e lastMouseMove\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e/*\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    determine if last mouse move caused a state change for point p\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    from no penetration to penetration into shape s (represented by sVertices)\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    if such state change occured, return the penetration vector\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e    if not, this return null\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e  */\u003c/span\u003e\n  \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e prev \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e sVertices\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003esVertices\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elength\u003c/span\u003e \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token comment\"\u003e// scale last mouse move vector by 20%, empirically this has been found to help \u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// with interseciton detection sensitivity\u003c/span\u003e\n  lastMouseMove \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e lastMouseMove\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eele\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e ele \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e \u003cspan class=\"token number\"\u003e1.2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\n  \u003cspan class=\"token comment\"\u003e// iterate through each polygon edge, return if penetration is encountered\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003efor\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e k \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e k \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e sVertices\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003elength\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e k\u003cspan class=\"token operator\"\u003e++\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e currVertex \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e sVertices\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003ek\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e edgeVec \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003etoVec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecurrVertex\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e prev\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// vector respresenting current polygon edge\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e res \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003efindIntersection\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ecurrVertex\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e edgeVec\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e p\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e lastMouseMove\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token keyword control-flow\"\u003eif\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eres\n      \u003cspan class=\"token operator\"\u003e\u0026#x26;\u0026#x26;\u003c/span\u003e res \u003cspan class=\"token operator\"\u003e\u003e\u003c/span\u003e \u003cspan class=\"token number\"\u003e0\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// res==0, when p started on on the polygon edge\u003c/span\u003e\n      \u003cspan class=\"token operator\"\u003e\u0026#x26;\u0026#x26;\u003c/span\u003e res \u003cspan class=\"token operator\"\u003e\u0026#x3C;\u003c/span\u003e \u003cspan class=\"token number\"\u003e1\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// res==1, when p is on polygon edge after mouse move\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// point indeed penetrated the current polygon edge\u003c/span\u003e\n      \u003cspan class=\"token comment\"\u003e// calculate and return perpendicular component between p and the polygon edge\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e p_currVertex_vec \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003etoVec\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ep\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e currVertex\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e \u003cspan class=\"token comment\"\u003e//\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003econst\u003c/span\u003e precalc \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token function\"\u003edot\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003ep_currVertex_vec\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e edgeVec\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token operator\"\u003e/\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eedgeVec\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e0\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e \u003cspan class=\"token operator\"\u003e+\u003c/span\u003e edgeVec\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e**\u003c/span\u003e \u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n      \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e p_currVertex_vec\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token method function property-access\"\u003emap\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token parameter\"\u003eele\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e idx\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token arrow operator\"\u003e=\u003e\u003c/span\u003e ele \u003cspan class=\"token operator\"\u003e-\u003c/span\u003e precalc \u003cspan class=\"token operator\"\u003e*\u003c/span\u003e edgeVec\u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003eidx\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n    prev \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e currVertex\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n  \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n  \u003cspan class=\"token keyword control-flow\"\u003ereturn\u003c/span\u003e \u003cspan class=\"token keyword null nil\"\u003enull\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e;\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eKnowing this penetration vector, the moving tile is then shifted back by the this exact amount, ensuring that the tiles are just touching, but not intersecting\u003c/p\u003e\n\u003ch2\u003ePuzzle generation\u003c/h2\u003e\n\u003cp\u003eInstead of generating the problem manually, examples of Tangram problems found online were leveraged. The 179 puzzles in this game was taken from a \u003ca href=\"https://web.archive.org/web/20200203050759/https://www.cs.brandeis.edu/~storer/JimPuzzles/ZPAGES/zzzRichter08-AnchorPuzzle.html\"\u003epuzzle booklet\u003c/a\u003e first published in 1890 by the Richter Company of Germany in 1890. The problems were extracted from scanned images of the puzzle booklet with a \u003ca href=\"https://github.com/twpride/tangram/blob/master/scratch/process179.py\"\u003epython script\u003c/a\u003e using OpenCv's \u003ccode\u003efindContours()\u003c/code\u003e.\u003c/p\u003e\n\u003ch1\u003eFeatures to add\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eUser generated levels\u003c/li\u003e\n\u003cli\u003ePublic high score leader board\u003c/li\u003e\n\u003c/ul\u003e\n","title":"179 Tangrams","date":"2020-01-05","preview":"https://raw.githubusercontent.com/twpride/tangram/master/demo/gamefull_opt.gif","bgColor":null,"blurb":"179 Tangrams is a browser implementation of the classic Chinese puzzle using plain JavaScript(no packages) and the Canvas API.","tags":["portfolio","game","canvas","another"]}},"__N_SSG":true},"page":"/projects/[id]","query":{"id":"tangram"},"buildId":"TToMUVPBe4JK1LalFgGft","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-144e5fa6fafab6397d9c.js"></script><script src="/_next/static/chunks/main-61129d213dfda76573c6.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.abffcf18e526b7c0dbcd.js" async=""></script><script src="/_next/static/chunks/3ef630e34cd10ba68f9d468ac363ff81c534e1e9.096d8e50c76d292127d5.js" async=""></script><script src="/_next/static/chunks/pages/_app-45fefa48abe535254545.js" async=""></script><script src="/_next/static/chunks/31be47c519c864dead363477679f4a7420a51993.fc03b16d3e52c095d9fb.js" async=""></script><script src="/_next/static/chunks/pages/projects/%5Bid%5D-e67dad879942af187726.js" async=""></script><script src="/_next/static/TToMUVPBe4JK1LalFgGft/_buildManifest.js" async=""></script><script src="/_next/static/TToMUVPBe4JK1LalFgGft/_ssgManifest.js" async=""></script></body></html>